# MCP jichitai-basic-information サーバー: 財務データ欠損に関する報告書

**報告日**: 2025-10-07
**報告者**: jichitaiSalesAnalyzer プロジェクトチーム
**対象MCPサーバー**: jichitai-basic-information
**対象ツール**: `get_jichitai_basic_info`

---

## 1. 問題の概要

134自治体のデータベース構築プロジェクトにおいて、38自治体（28.4%）で財務データ（finance フィールド）が欠損または部分的に欠損していることが判明しました。調査の結果、これはMCPツールの問題ではなく、**データソースの仕様上の制限**であることが確認されました。

---

## 2. データソースの制限

### 2.1 総務省「市町村別決算状況調」の対象範囲

MCPツールが使用しているデータソース:
- **名称**: 総務省「市町村別決算状況調」令和5年度
- **対象**: **815市のみ**
- **対象外**: 町村（全国の町村は収録されていない）

### 2.2 東京都特別区の特殊性

東京都23区については、以下の指標が制度上計算されていません:
- 標準財政規模 (standard_fiscal_scale)
- 財政力指数 (financial_capability_index)
- 実質公債費比率 (real_debt_service_ratio)

これらの指標は地方交付税制度に基づく計算であり、特別区は算定対象外です。

---

## 3. MCPツールの挙動分析

### 3.1 町村に対する挙動

**テストケース**: 矢巾町（jichitai_code: 033227）

```json
{
  "jichitai_code": "033227",
  "jichitai_name": "矢巾町",
  "prefecture": "岩手県",
  "jichitai_type": "町",
  "population": {...},
  "households": 11162,
  "population_dynamics": {...},
  "data_sources": {
    "population_source": "令和6年1月1日住民基本台帳"
  }
}
```

**観察**: `finance` フィールド自体が返されない（存在しない）

### 3.2 特別区に対する挙動

**テストケース**: 世田谷区（jichitai_code: 131121）

```json
{
  "jichitai_code": "131121",
  "jichitai_name": "世田谷区",
  "prefecture": "東京都",
  "population": {...},
  "data_sources": {
    "population_source": "令和6年1月1日住民基本台帳",
    "finance_source": "令和5年度市町村別決算状況調"
  },
  "finance": {
    "standard_fiscal_scale": "-",
    "real_balance_ratio": "-",
    "current_balance_ratio": 80.8,
    "financial_capability_index": "-",
    "revenue_total": 390598653,
    "expenditure_total": 370376911
  }
}
```

**観察**: `finance` フィールドは存在するが、一部の値が文字列 `"-"` で返される

---

## 4. 影響を受ける自治体リスト

### 4.1 完全欠損（26自治体）- 町村

| 都道府県 | 自治体コード | 自治体名 | タイプ |
|---------|------------|---------|--------|
| 岩手県 | 033227 | 矢巾町 | 町 |
| 埼玉県 | 113611 | 横瀬町 | 町 |
| 宮城県 | 043214 | 大河原町 | 町 |
| 神奈川県 | 143421 | 二宮町 | 町 |
| 三重県 | 244422 | 明和町 | 町 |
| 三重県 | 244619 | 玉城町 | 町 |
| 三重県 | 245437 | 紀北町 | 町 |
| 愛知県 | 233021 | 東郷町 | 町 |
| 愛知県 | 234249 | 大治町 | 町 |
| 愛知県 | 235016 | 幸田町 | 町 |
| 福井県 | 184047 | 南越前町 | 町 |
| 福井県 | 184420 | 美浜町 | 町 |
| 福井県 | 184811 | 高浜町 | 町 |
| 福井県 | 184837 | おおい町 | 町 |
| 大阪府 | 273210 | 豊能町 | 町 |
| 島根県 | 323438 | 奥出雲町 | 町 |
| 島根県 | 323861 | 飯南町 | 町 |
| 島根県 | 324418 | 川本町 | 町 |
| 島根県 | 324493 | 邑南町 | 町 |
| 島根県 | 325015 | 津和野町 | 町 |
| 島根県 | 325058 | 吉賀町 | 町 |
| 島根県 | 325252 | 海士町 | 町 |
| 島根県 | 325261 | 西ノ島町 | 町 |
| 島根県 | 325279 | 知夫村 | 村 |
| 島根県 | 325287 | 隠岐の島町 | 町 |
| 広島県 | 343099 | 坂町 | 町 |
| 福岡県 | 406252 | みやこ町 | 町 |

**計**: 26自治体

### 4.2 部分欠損（12自治体）- 東京都特別区

| 自治体コード | 自治体名 | 欠損項目 |
|------------|---------|----------|
| 131016 | 千代田区 | standard_fiscal_scale, financial_capability_index, real_balance_ratio |
| 131032 | 港区 | 同上 |
| 131059 | 文京区 | 同上 |
| 131067 | 台東区 | 同上 |
| 131091 | 品川区 | 同上 |
| 131113 | 大田区 | 同上 |
| 131121 | 世田谷区 | 同上 |
| 131156 | 杉並区 | 同上 |
| 131164 | 豊島区 | 同上 |
| 131181 | 荒川区 | 同上 |
| 131237 | 江戸川区 | 同上 |
| (他1区) | - | 同上 |

**計**: 12自治体

---

## 5. 技術的な課題と改善提案

### 5.1 現在の問題点

#### A. スキーマの不一致
- 市の場合: `finance` フィールドが存在し、全項目に値がある
- 特別区の場合: `finance` フィールドが存在するが、一部の値が文字列 `"-"`
- 町村の場合: `finance` フィールド自体が存在しない

この不一致により、データ処理時にエラーハンドリングが複雑になります。

#### B. データ型の不整合
- `"-"` が文字列で返されるため、数値型として処理できない
- NULL や特殊値との区別が困難

### 5.2 改善提案

#### 提案1: スキーマの統一化（推奨）

すべての自治体で `finance` フィールドを返し、データが存在しない場合は `null` を返す:

```json
{
  "jichitai_code": "033227",
  "jichitai_name": "矢巾町",
  "finance": {
    "standard_fiscal_scale": null,
    "real_balance_ratio": null,
    "current_balance_ratio": null,
    "financial_capability_index": null,
    "revenue_total": null,
    "expenditure_total": null
  },
  "data_sources": {
    "population_source": "令和6年1月1日住民基本台帳",
    "finance_source": null
  },
  "finance_note": "財務データは市のみ対象（総務省「市町村別決算状況調」）"
}
```

#### 提案2: メタデータの追加

`finance` フィールドに `data_availability` メタデータを追加:

```json
{
  "finance": {
    "data_availability": {
      "available": false,
      "reason": "町村は総務省「市町村別決算状況調」の対象外"
    }
  }
}
```

#### 提案3: ハイフンの扱いの明確化

文字列 `"-"` を `null` に変更するか、専用の `NOT_APPLICABLE` 定数を使用:

```json
{
  "finance": {
    "standard_fiscal_scale": null,
    "standard_fiscal_scale_note": "特別区は算定対象外"
  }
}
```

---

## 6. ドキュメント改善の提案

### 6.1 README/ドキュメントへの追記

以下の情報をツールのドキュメントに明記することを推奨します:

```markdown
## データの制限事項

### 財務データ (finance)

- **対象**: 市のみ（815市）
- **対象外**: 町村（財務データは取得不可）
- **データソース**: 総務省「市町村別決算状況調」令和5年度

### 東京都特別区の特殊性

以下の指標は特別区では算定されません（`"-"` で返されます）:
- 標準財政規模 (standard_fiscal_scale)
- 財政力指数 (financial_capability_index)
- 実質公債費比率 (real_balance_ratio)

理由: 地方交付税制度の算定対象外
```

### 6.2 ツールの説明文への追記

```python
"""
Get basic information (population, finance, etc.) for a Japanese municipality.

NOTE: Financial data is only available for cities (市).
Towns (町) and villages (村) are not included in the data source.
For Tokyo special wards, some financial indicators are not calculated.
"""
```

---

## 7. 影響範囲

### 7.1 データ完全性
- **市**: 財務データ完全 (96自治体)
- **町村**: 財務データなし (26自治体)
- **特別区**: 部分的なデータ (12自治体)

### 7.2 利用者への影響
- データ分析時に町村を除外する必要がある
- 特別区の一部指標は比較対象から除外する必要がある
- エラーハンドリングのロジックが複雑化

---

## 8. 結論

この問題は**MCPツールのバグではなく、データソースの仕様上の制限**です。ただし、以下の改善により利用者体験を向上できます:

1. **スキーマの統一**: すべての自治体で `finance` フィールドを返す
2. **データ型の整合性**: `"-"` を `null` に変更
3. **ドキュメント化**: データ制限を明確に記載
4. **メタデータの追加**: データの可用性情報を含める

これらの改善により、データ処理の一貫性が向上し、エラーハンドリングが簡素化されます。

---

## 9. 添付資料

- 欠損データを含む38自治体の完全なリスト（SQL クエリ結果）
- MCPツールのレスポンス例（市、町、特別区）
- データベーススキーマ定義

---

## 10. 連絡先

本報告書に関するお問い合わせ:
- プロジェクト: jichitaiSalesAnalyzer
- ディレクトリ: `/Users/tskymmt/git/jichitaiSalesAnalyzer/preRsearch/導入済み自治体調査/`
